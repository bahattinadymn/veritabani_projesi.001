{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="text-center mb-5">
        <h2 class="fw-bold text-warning display-5">ğŸ† Okuma ÅampiyonlarÄ±</h2>
        <p class="text-muted">KÃ¼tÃ¼phanenin en Ã§alÄ±ÅŸkan Ã¼yeleri</p>
    </div>

    <div class="row justify-content-center align-items-end mb-5" id="topThree">
        <div class="spinner-border text-warning" role="status"></div>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white py-3">
                    <h5 class="mb-0 fw-bold">ğŸ“‹ Top 10 Listesi</h5>
                </div>
                <ul class="list-group list-group-flush" id="leaderboardList">
                    </ul>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", loadLeaderboard);

    async function loadLeaderboard() {
        try {
            // Backend'den en Ã§ok okuyanlarÄ± iste
            // NOT: Backend'inde /api/reports/leaderboard endpoint'i olmalÄ±.
            // EÄŸer yoksa report_controller ve service'e ekleyeceÄŸiz.
            const response = await fetch('/api/reports/leaderboard'); 
            const users = await response.json();

            renderTopThree(users.slice(0, 3)); // Ä°lk 3
            renderList(users.slice(3));        // Geri kalanÄ±
        } catch (error) {
            console.error("Hata:", error);
            document.getElementById('topThree').innerHTML = '<div class="alert alert-danger">Veriler yÃ¼klenemedi.</div>';
        }
    }

    function renderTopThree(users) {
        const container = document.getElementById('topThree');
        container.innerHTML = '';

        // KÃ¼rsÃ¼ tasarÄ±mÄ± (2. - 1. - 3. sÄ±rasÄ±nda dizersen gÃ¶rsel olarak kÃ¼rsÃ¼ olur)
        const order = [1, 0, 2]; // users dizisindeki indexler
        const heights = ["180px", "220px", "160px"];
        const colors = ["silver", "gold", "#cd7f32"]; // GÃ¼mÃ¼ÅŸ, AltÄ±n, Bronz
        const badges = ["ğŸ¥ˆ", "ğŸ¥‡", "ğŸ¥‰"];

        order.forEach((idx, i) => {
            if (!users[idx]) return; // KullanÄ±cÄ± yoksa geÃ§
            
            const user = users[idx];
            const html = `
            <div class="col-4 col-md-3 text-center">
                <div class="mb-2">
                    <span class="display-4">${badges[i]}</span>
                </div>
                <div class="card border-0 shadow-sm" style="height: ${heights[i]}; background: ${colors[i]}20; border-top: 5px solid ${colors[i]} !important;">
                    <div class="card-body d-flex flex-column justify-content-center">
                        <h5 class="fw-bold text-dark">${user.ad} ${user.soyad}</h5>
                        <p class="mb-0 fw-bold text-muted">${user.okunan_kitap} Kitap</p>
                    </div>
                </div>
            </div>`;
            container.innerHTML += html;
        });
    }

    function renderList(users) {
        const list = document.getElementById('leaderboardList');
        if(users.length === 0) {
            list.innerHTML = '<li class="list-group-item text-center text-muted">Listede baÅŸka kimse yok. YarÄ±ÅŸa katÄ±l!</li>';
            return;
        }

        users.forEach((user, index) => {
            const html = `
            <li class="list-group-item d-flex justify-content-between align-items-center py-3">
                <div class="d-flex align-items-center">
                    <span class="badge bg-light text-dark rounded-circle border me-3" style="width: 30px; height: 30px; line-height: 20px;">${index + 4}</span>
                    <span class="fw-bold">${user.ad} ${user.soyad}</span>
                </div>
                <span class="badge bg-primary rounded-pill">${user.okunan_kitap} Kitap</span>
            </li>`;
            list.innerHTML += html;
        });
    }
</script>
{% endblock %}